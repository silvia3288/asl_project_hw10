{% extends "layout.html" %}

{% block content %}

<h2>Learn: Helpful Phrases</h2>
<p>Choose a word or phrase below to start!</p>

<div id="phrases-container" class="d-flex flex-wrap justify-content-around"></div>

<form method="post" action="{{ url_for('greetings_page') }} " class="mt-3 mt-3 d-flex justify-content-center">
    <button type="submit" class="btn btn-primary">Complete Greetings section</button>
</form>

<div id="quiz-button" style="display: none;" class="text-center mt-4">
    <a href="{{ url_for('quiz') }}" class="btn btn-success">Start Quiz</a>
</div>



<script>
    const serverSessionId = '{{ session_id }}';
    const storedSessionId = localStorage.getItem('sessionId');

    if (storedSessionId !== serverSessionId) {
        localStorage.clear();
        localStorage.setItem('sessionId', serverSessionId);
    }

    let phrases = {{ popular_items|tojson|safe }};
    let allVisitedPhrases = true; // Assume all phrases are visited at the start

    function displayPhrases(items) {
        const container = document.getElementById('phrases-container');
        container.innerHTML = '';
        items.forEach(item => {
            const buttonElement = document.createElement('button');
            buttonElement.className = 'greeting-btn btn btn-secondary m-1';
            buttonElement.innerText = item.name;

            if (localStorage.getItem(item.id) === 'visited') {
                buttonElement.classList.add('visited');
            } else {
                allVisitedPhrases = false; // Set to false if any item hasn't been visited
            }

            buttonElement.onclick = function () {
                localStorage.setItem(item.id, 'visited');
                window.location.href = "/view/" + item.id;
                checkAllVisitedPhrases(); // Recheck if all items are visited
            };
            container.appendChild(buttonElement);
        });
        checkAllVisitedPhrases(); // Initial check
    }

    function checkAllVisitedPhrases() {
        if (allVisitedPhrases) {
            localStorage.setItem('completed_phrases', 'true');
        } else {
            localStorage.removeItem('completed_phrases');
        }
        checkQuizAvailability(); // Check if both sections are completed
    }

    function checkQuizAvailability() {
        const completedGreetings = localStorage.getItem('completed_greetings') === 'true';
        const completedPhrases = localStorage.getItem('completed_phrases') === 'true';
        if (completedGreetings && completedPhrases) {
            document.getElementById('quiz-button').style.display = 'block';
        } else {
            document.getElementById('quiz-button').style.display = 'none';
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        displayPhrases(phrases);
    });
</script>







{% endblock %}
